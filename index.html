<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.8, maximum-scale=1.0, user-scalable=no">
    <title>ğŸ’• A Special Question For Khushi ğŸ’•</title>
    <!-- CSS externo -->
    <link rel="stylesheet" href="celebrationstyle.css">
</head>
<body>
    <!-- Floating Items Background -->
    <div class="hearts-container" id="heartsContainer"></div>

    <!-- Small Decorative Elements -->
    <div class="decoration deco-1">ğŸŒ¸</div>
    <div class="decoration deco-2">ğŸŒº</div>
    <div class="decoration deco-3">ğŸŒ·</div>
    <div class="decoration deco-4">ğŸŒ¹</div>

    <!-- Giant Teddy Bear Wrapper -->
    <div class="teddy-wrapper">
        
        <!-- Floating Hearts Above Teddy -->
        <div class="teddy-hearts">
            <span class="teddy-love">ğŸ’•</span>
            <span class="teddy-love">ğŸ’–</span>
            <span class="teddy-love">ğŸ’—</span>
        </div>

        <!-- Teddy Head (on top) -->
        <div class="teddy-head">ğŸ§¸</div>

        <!-- Teddy Body Section -->
        <div class="teddy-body">
            
            <!-- Blurred Teddy Torso Behind Card -->
            <div class="teddy-torso">ğŸ§¸</div>
            
            <!-- Left Paw -->
            <div class="teddy-paw-left">ğŸ¾</div>

            <!-- Main Card (on teddy's torso) -->
            <div class="card" id="mainCard">
                <div class="big-heart">ğŸ’–</div>
                
                <h1 class="title">Hey <span class="name-highlight">Khushi</span>! âœ¨</h1>
                <p class="subtitle">I have something very special to ask you...</p>
                
                <h2 class="question">
                    <span class="name-in-question">Khushi</span>, Will You Be My Valentine? ğŸ’•
                </h2>
                
                <div class="buttons-container" id="buttonsContainer">
                    <button class="btn btn-yes" id="yesBtn" onclick="sayYes()">Yes! ğŸ’–</button>
                    <button class="btn btn-no" id="noBtn" onmouseover="runAway()" onclick="runAway()">No</button>
                </div>

                <div class="love-note">
                    <p>Every love story is beautiful, but <span>ours is my favorite</span> ğŸ’•</p>
                </div>
            </div>

            <!-- Right Paw -->
            <div class="teddy-paw-right">ğŸ¾</div>
        </div>

        <!-- Teddy Feet (at bottom) -->
        <div class="teddy-feet">
            <div class="teddy-foot teddy-foot-left">ğŸ¾</div>
            <div class="teddy-foot teddy-foot-right">ğŸ¾</div>
        </div>
    </div>

    <!-- Hover Message -->
    <div class="hover-message" id="hoverMessage">
        Nope! That's not an option! ğŸ˜œğŸ’•
    </div>

    <script src="celebrationscript.js"></script> 
    <!-- Background Music -->
    <audio id="bgMusic" loop preload="auto">
        <source src="Where-Is-My-Husband.mp3" type="audio/mpeg">
    </audio>

    <!-- Music Control Button -->
    <button id="musicToggle" class="music-btn">ğŸµ</button>

    <style>
        .music-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 55px;
            height: 55px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff69b4, #a855f7);
            color: white;
            border: 2px solid rgba(255,255,255,0.3);
            cursor: pointer;
            font-size: 22px;
            z-index: 9999;
            box-shadow: 0 5px 25px rgba(255,105,180,0.5);
            transition: all 0.3s ease;
            animation: pulse-music 2s ease-in-out infinite;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .music-btn:hover {
            transform: scale(1.15);
            box-shadow: 0 8px 35px rgba(255,105,180,0.7);
        }

        .music-btn.playing {
            animation: none;
            background: linear-gradient(135deg, #a855f7, #667eea);
        }

        .music-btn.playing::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 2px solid rgba(255,105,180,0.5);
            animation: music-wave 1.5s ease-out infinite;
        }

        @keyframes pulse-music {
            0%, 100% { 
                box-shadow: 0 5px 25px rgba(255,105,180,0.5);
            }
            50% { 
                box-shadow: 0 5px 25px rgba(255,105,180,0.8), 
                            0 0 0 12px rgba(255,105,180,0.15);
            }
        }

        @keyframes music-wave {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            100% {
                transform: scale(1.8);
                opacity: 0;
            }
        }

        /* Music visualizer bars when playing */
        .music-btn.playing .music-bars {
            display: flex;
        }

        .music-bars {
            display: none;
            gap: 2px;
            height: 20px;
            align-items: flex-end;
        }

        .music-bar {
            width: 3px;
            background: white;
            border-radius: 2px;
            animation: bar-dance 0.5s ease-in-out infinite;
        }

        .music-bar:nth-child(1) { height: 8px; animation-delay: 0s; }
        .music-bar:nth-child(2) { height: 16px; animation-delay: 0.1s; }
        .music-bar:nth-child(3) { height: 12px; animation-delay: 0.2s; }
        .music-bar:nth-child(4) { height: 18px; animation-delay: 0.3s; }

        @keyframes bar-dance {
            0%, 100% { transform: scaleY(1); }
            50% { transform: scaleY(0.5); }
        }
    </style>

    <script>
        // ========== MUSIC CONTROLLER ==========
        const music = document.getElementById('bgMusic');
        const musicBtn = document.getElementById('musicToggle');
        let isMusicPlaying = false;
        let hasMusicInteracted = false;

        // Music settings
        music.volume = 0.4;
        const startTime = 11; // Start from 10 seconds

        // Create visualizer bars
        const barsContainer = document.createElement('div');
        barsContainer.className = 'music-bars';
        for (let i = 0; i < 4; i++) {
            const bar = document.createElement('div');
            bar.className = 'music-bar';
            barsContainer.appendChild(bar);
        }
        musicBtn.innerHTML = '';
        musicBtn.appendChild(document.createTextNode('ğŸµ'));

        // Function to start music
        function startMusic() {
            music.currentTime = startTime;
            music.play().then(() => {
                isMusicPlaying = true;
                hasMusicInteracted = true;
                updateMusicButton();
            }).catch(err => {
                console.log('Music play failed:', err);
            });
        }

        // Function to update button appearance
        function updateMusicButton() {
            if (isMusicPlaying) {
                musicBtn.innerHTML = '';
                musicBtn.appendChild(barsContainer.cloneNode(true));
                musicBtn.classList.add('playing');
            } else {
                musicBtn.innerHTML = 'ğŸµ';
                musicBtn.classList.remove('playing');
            }
        }

        // Toggle music function
        function toggleMusic(e) {
            e.stopPropagation();
            
            if (!hasMusicInteracted) {
                startMusic();
                return;
            }

            if (isMusicPlaying) {
                music.pause();
                isMusicPlaying = false;
            } else {
                music.currentTime = startTime;
                music.play();
                isMusicPlaying = true;
            }
            updateMusicButton();
        }

        // Button click handler
        musicBtn.addEventListener('click', toggleMusic);

        // All possible interaction events for autoplay
        const interactionEvents = [
            'click',
            'touchstart',
            'mousemove',
            'scroll',
            'keydown'
        ];

        // Handler for first interaction
        function onFirstInteraction(e) {
            if (hasMusicInteracted) return;
            if (e.target.id === 'musicToggle') return; // Let button handle itself
            
            startMusic();
            removeInteractionListeners();
        }

        // Add interaction listeners
        function addInteractionListeners() {
            interactionEvents.forEach(event => {
                document.addEventListener(event, onFirstInteraction, { passive: true });
            });
        }

        // Remove interaction listeners
        function removeInteractionListeners() {
            interactionEvents.forEach(event => {
                document.removeEventListener(event, onFirstInteraction);
            });
        }

        // Try autoplay first
        music.currentTime = startTime;
        music.play().then(() => {
            isMusicPlaying = true;
            hasMusicInteracted = true;
            updateMusicButton();
            removeInteractionListeners();
        }).catch(() => {
            // Autoplay blocked - add listeners for first interaction
            console.log('ğŸµ Waiting for interaction to play music...');
            addInteractionListeners();
        });

        // Handle page visibility (pause when tab hidden)
        document.addEventListener('visibilitychange', () => {
            if (!hasMusicInteracted) return;
            
            if (document.hidden && isMusicPlaying) {
                music.pause();
            } else if (!document.hidden && isMusicPlaying) {
                music.play();
            }
        });

        // When song loops, restart from 9 seconds
        music.addEventListener('ended', () => {
            music.currentTime = startTime;
            music.play();
        });

        // Double-check loop reset (in case 'ended' doesn't fire with loop)
        music.addEventListener('timeupdate', () => {
            // If near the end, go back to start time
            if (music.duration - music.currentTime < 0.5) {
                music.currentTime = startTime;
            }
        });
    </script>
</body>
</html>
